Самостоятельная работа: Создание и миграция данных сущности Furniture между PostgreSQL и MongoDB
Цель
Научиться создавать сущность Furniture (мебель) в Java, генерировать 5000 записей в PostgreSQL, выбирать записи по критерию (тип "Стул") и переносить их в коллекцию MongoDB, а также собирать проект в исполняемый Fat JAR, включающий все зависимости.
Контекст
Вы уже знаете, как создавать Gradle-проект, подключать PostgreSQL через JDBC и выполнять CRUD-операции. В этой работе вы создадите сущность Furniture с полями type (Enum: Кресло, Стул, Диван), material (строка), price (целое число) и color (строка). Программа сгенерирует 5000 записей в таблице PostgreSQL, выберет все записи с типом "Стул" и перенесёт их в коллекцию MongoDB. Проект будет упакован в Fat JAR для автономного запуска.
Необходимые инструменты


Зависимости

org.postgresql:postgresql:42.7.3 — JDBC-драйвер для PostgreSQL.
org.mongodb:mongodb-driver-sync:5.2.0 — драйвер для MongoDB (синхронная версия).
Плагин com.github.johnrengelman.shadow:8.1.1 — для создания Fat JAR.

Подготовка

Проверьте PostgreSQL:

Убедитесь, что PostgreSQL установлен (скачайте с официального сайта, версия 13+).
Проверьте, что сервер запущен:
В командной строке: pg_ctl status.
Или в pgAdmin проверьте статус сервера.


Запомните имя пользователя (по умолчанию postgres) и пароль.
Создайте базу данных furniture_db:CREATE DATABASE furniture_db;


Проверьте MongoDB:

Убедитесь, что MongoDB установлен (скачайте с официального сайта, версия 6.0+).
Проверьте, что сервер запущен:
В командной строке: mongod --version.
Или используйте MongoDB Compass для проверки.


MongoDB создаёт базу и коллекцию автоматически при первой вставке.


Параметры подключения:

PostgreSQL:
URL: jdbc:postgresql://localhost:5432/furniture_db
Пользователь: postgres (или ваш).
Пароль: ваш пароль.


MongoDB:
URL: mongodb://localhost:27017
База данных: furniture_db
Коллекция: furniture



Задание

Настройте Gradle-проект с Fat JAR:

В файле build.gradle добавьте зависимости для PostgreSQL (org.postgresql:postgresql:42.7.3) и MongoDB (org.mongodb:mongodb-driver-sync:5.2.0).
Подключите плагин com.github.johnrengelman.shadow (версия 8.1.1) для создания Fat JAR.
Настройте плагины для работы с Java и запуска приложения.
Укажите главный класс (например, com.example.FurnitureManager).
Настройте задачу shadowJar для создания Fat JAR с именем furniture-manager.jar, включающего все зависимости.


Создайте таблицу в PostgreSQL:

Создайте таблицу furniture в базе furniture_db с полями:
id — уникальный идентификатор (SERIAL, первичный ключ).
type — тип мебели (строка, не null, значения: "Кресло", "Стул", "Диван").
material — материал (строка, не null).
price — цена (целое число).
color — цвет (строка, не null).


Таблица создаётся через SQL-запрос в psql или pgAdmin.


Создайте сущность Furniture:

Создайте Java-класс Furniture в пакете com.example, представляющий запись в таблице/коллекции.
Класс должен содержать поля:
id — целое число.
type — Enum с значениями ARMCHAIR, CHAIR, SOFA (соответствует "Кресло", "Стул", "Диван").
material — строка.
price — целое число.
color — строка.


Добавьте конструктор, геттеры и метод toString для удобного вывода.


Напишите программу для работы с базами данных:

Создайте класс FurnitureManager в пакете com.example с методом main.
Программа должна:
Подключиться к PostgreSQL с использованием JDBC (DriverManager.getConnection).
Подключиться к MongoDB с использованием MongoDB Java Driver (MongoClient, MongoDatabase, MongoCollection).
Создать 5000 записей в PostgreSQL:
Сгенерируйте 5000 записей для таблицы furniture, используя случайные или предопределённые значения для полей type, material, price, color.
Например, type может быть случайным из Enum, material — из списка ("Дерево", "Металл", "Пластик"), price — от 1000 до 100000, color — из списка ("Красный", "Синий", "Зелёный").
Используйте PreparedStatement для вставки данных.


Выбрать все стулья (type="Стул") из PostgreSQL:
Напишите SQL-запрос для выборки записей, где type='Стул'.
Используйте PreparedStatement для безопасности.


Перенести стулья в MongoDB:
Перенесите выбранные записи (стулья) из PostgreSQL в коллекцию furniture базы furniture_db в MongoDB.
Используйте методы MongoDB Java Driver (например, insertOne) для вставки.


После каждой операции (создание записей, выборка, миграция) выводите результаты в консоль (например, количество созданных записей, список стульев, список в MongoDB).
Используйте try-with-resources для управления ресурсами JDBC.
Обрабатывайте ошибки (SQLException для PostgreSQL, MongoException для MongoDB) и выводите их сообщения.


Соберите и проверьте Fat JAR:

Скомпилируйте проект и создайте Fat JAR с помощью Gradle (задача shadowJar).
Проверьте, что программа запускается через задачу Gradle run.
Убедитесь, что Fat JAR работает через команду java -jar, без необходимости добавлять внешние зависимости.



Бонусные задания (для желающих)

Добавьте метод для выборки мебели по материалу в MongoDB (например, используя Filters.eq("material", "value")).
Реализуйте ввод параметров для генерации данных через Scanner (например, выбор материалов или цветов).
Добавьте проверку, чтобы программа сообщала, если стулья не найдены в PostgreSQL.

